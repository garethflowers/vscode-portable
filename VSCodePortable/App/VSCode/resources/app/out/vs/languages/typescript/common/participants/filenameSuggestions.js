/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";var __decorate=this&&this.__decorate||function(e,t,r,n){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(e,t,r,n);switch(arguments.length){case 2:return e.reduceRight(function(e,t){return t&&t(e)||e},t);case 3:return e.reduceRight(function(e,n){return void(n&&n(t,r))},void 0);case 4:return e.reduceRight(function(e,n){return n&&n(t,r,e)||e},n)}},__param=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};define("vs/languages/typescript/common/participants/filenameSuggestions",["require","exports","vs/base/common/uri","vs/base/common/strings","vs/base/common/paths","vs/base/common/collections","vs/base/common/winjs.base","vs/languages/typescript/common/lib/typescriptServices","vs/languages/typescript/common/project/projectService","vs/editor/common/services/resourceService"],function(e,t,r,n,i,o,s,a,u,c){var f=function(){function e(){}return e.prototype.makeModulePath=function(e,t,r){return e?this._toRequirePath(t,r):this._toReferencesPath(t,r)},e.prototype._toRequirePath=function(e,t){var r,o=i.dirname(t);return r=i.join(i.relative(o,i.dirname(e)),i.basename(e)),n.startsWith(r,"..")||(r="./"+r),r=n.rtrim(r,".ts"),r=n.rtrim(r,".js")},e.prototype._toReferencesPath=function(e,t){var r=i.dirname(t);return i.join(i.relative(r,i.dirname(e)),i.basename(e))},e}();t.PathMaker=f;var l=function(){function e(e){this._resourceServices=e}return e.prototype.suggest=function(e,t,i){if(!(i instanceof u.ProjectService))return s.TPromise.as(null);var a=i.getProject(e),c=a.languageService.getSourceFile(e.toString()),l=this._findCurrentWord(e,t,c);if(!l)return s.TPromise.as(null);var g=new f,m=/^['"]/.test(l.wordUntilPosition)?l.wordUntilPosition[0]:'"',d={currentWord:l.wordUntilPosition,suggestions:[]},p=Object.create(null);return i.scriptsNames().forEach(function(t){if(!(l.external&&n.endsWith(t,".d.ts")||t===e.toString()||p[t]||"file"!==r["default"].parse(t).scheme)){var i=g.makeModulePath(l.external,t,e.toString());p[t]={label:n.format("{0}{1}{0}",m,i),codeSnippet:n.rtrim(n.format("{0}{1}{0}",m,i),l.wordAfterPosition),documentationLabel:r["default"].parse(t).fsPath,type:"reference"}}}),d.suggestions=o.values(p),s.TPromise.as(d)},e.prototype._findCurrentWord=function(t,r,n){var i=this._resourceServices.get(t),o=i.getOffsetFromPosition(r),s=a.findTokenOnLeftOfPosition(n,o),u=i.getLineContent(r.lineNumber),c=e._TrippleSlashReference.exec(u);if(c){var f=i.getOffsetFromPosition({lineNumber:r.lineNumber,column:1});return{wordUntilPosition:c[2].substring(0,o-(f+c[1].length)),wordAfterPosition:c[2].substring(o-(f+c[1].length)),external:!1}}if(g.isTokenPath(s,8,160))return{wordUntilPosition:a.getTextOfNode(s).substr(0,o-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(o-s.getStart()),external:!0};if(g.isTokenPath(s,8,156,160)){var l=g.parent(s,2);if("require"===a.getTextOfNode(l.expression)||"define"===a.getTextOfNode(l.expression))return{wordUntilPosition:a.getTextOfNode(s).substr(0,o-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(o-s.getStart()),external:!0}}},e._TrippleSlashReference=/^(\/\/\/\s*<reference\s+path=)([^\s>]+)/i,e=__decorate([__param(0,c.IResourceService)],e)}();t.FilenameSuggestions=l;var g;!function(e){function t(e,t){for(;t-- >0&&e;)e=e.parent;return e}function r(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(;t.length>0&&e;){var n=t.shift();if(n!==e.kind)return!1;e=e.parent}return!0}e.parent=t,e.isTokenPath=r}(g||(g={}))});